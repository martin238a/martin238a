<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="scripts/d3.js"></script>
  <title>Postgres node.js template med d3.js</title>
</head>

<body>
  <h1>Postgres node.js template med d3.js</h1>

  <script>
  // Denne query kører op imod API'en som findes i 'main.js'.
  // Denne HTML skal derfor åbnes igennem serveren for at virke.
  d3.json("/api/bnp", {
    method: "POST", 
  }).then(function(response) {
    const data = response.data; // Hent data ud af response
    console.log("data", data);

    const w = 1000;
    const h = 600;

    // Lav SVG element
    const svg = d3.select("body")
      .append("svg")
      .attr("width", w)
      .attr("height", h); 
      
    // Lav din egen visualsering med data her!

     // Selve datasættet
     const dataset = data;
     const sidePadding = 10;
     const bottomPadding = 50;

     //lav en skala fro x-aksen
     const xScale = d3.scaleLinear()
      .domain([0, d3.max(data, d => +d.ikkeadgangtilrentvand, function (d) { return d.ikkeadgangtilrentvand; })])
      .range([sidePadding, w-sidePadding]);
    // Lav en skala for y-aksen
    const yScale = d3.scaleLinear()
      .domain([0, d3.max(data, d=> +d.bnp, function (d) { return d.bnp; })])
      .range([h-bottomPadding, bottomPadding]);

// Lave scatter plot (punktdiagram)
svg.selectAll("circle") // <-- Før var det 'rect'
  .data(dataset)
  .enter()
  .append("circle") // <-- Før var det 'rect'
  .attr("cx", function(d) {
    // 'd' er et koordinat på formen [x, y]
    return xScale(d.ikkeadgangtilrentvand); // Første værdi i indre array (x)
  })
  .attr("cy", function(d) {
    return yScale(d.bnp); // Anden værdi i indre array (y)
  })
  .attr("r", function(d) {
    return d.doedsrate/5;
  }); // Radius er en konstant på '5'
/*
  const x = d3
   .scaleLinear()
   .domain([d3.min(dataset, d => d.ikkeadgangtilrentvand), d3.max(dataset, d => d.ikkeadgangtilrentvand)])
   .range([0, w]);
   svg
   .append("svg")
   .attr("transform", "translate(0, ${height})")
   .attr("class", "xAxis")
   .call(d3.axisBottom(x));
  */

// En akse-funktion baseret på skaleringsfunktionen
const xAxis = d3.axisBottom().scale(xScale);
// På SVG laver vi en <g>
// <g> er en container der indeholder andre SVG-elementer.
svg.append("g") 
  // "transform" er en flytning af hele <g>
  // Eller på dansk: "parallelforskydning".
  // Den flyttes ned i bunden af diagrammet
  .attr("transform", "translate(0," + (h - bottomPadding) + ")")
  // "call" bruger akse-funktionen til at lave selve aksen.
  .call(xAxis);

// En akse-funktion baseret på skaleringsfunktionen
const yAxis = d3.axisRight().scale(yScale);
// På SVG laver vi en <g>
// <g> er en container der indeholder andre SVG-elementer.
svg.append("g") 
  // "transform" er en flytning af hele <g>
  // Eller på dansk: "parallelforskydning".
  // Den flyttes ned i bunden af diagrammet
  .attr("transform", "translate(" + (sidePadding) +"," + "rotate(-90)")
  // "call" bruger akse-funktionen til at lave selve aksen.
  .call(yAxis);



/*
  const y = d3
    .scaleLinear()
    .domain([0, d3.max(data, d => +d.bnp)])
    .range([h, 0])
                        svg
    .append("svg")
    .attr("class", "yAxis")
    .call(d3.axisLeft(y))
     // Add titles to the y axis
    .append("text")
    .attr("class", "yAxis_label")
    .text("TWh")
    .attr("text-anchor", "middle")
    .attr("transform", "translate(" + (20) + "," + (h / 2) + ")rotate(-90)") // text is drawn off the screen top left, move down and out and rotate
    .attr("color", "black"); */
  });
  
  </script>
</body>
</html>
